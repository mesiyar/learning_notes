# MySql 优化
## 1. 概述 
### 1.1 为什么要进行MySql 优化
.一个应用的瓶颈往往在数据库的处理速度上
.随着应用的使用，数据库数据逐渐增多，数据库处理压力则见增大
.关系型数据库数据都放在磁盘上，读写速度较慢（与内存的数据库相比）
### 1.2 如何优化
.表字段的设计阶段,应当选用最有的存储和计算
.数据库自身提供的优化功能,如索引 explain 工具
.横向扩展,主从复制,读写分离,负载均衡和高可用
.典型的SQL语句的优化
##2 字段设计
###2.1 典型方案
.对精度有要求的 一般使用decimal 类型 或者把小数转换成整数
.能用整数表示的字符串尽量使用整数表示 如 ip INET_ATON("192.168.1.1")  INET_NTOA(3232235777)
.字段尽可能都使用 not null (null数值计算逻辑比较复杂)
.char 和varchar 的选择 如果事先设计字段的长度是固定的 使用 char 其他使用 varchar 
char 和 varchar的区别在于对char而言 如果长度超过预设的长度 那么超出长度的内容将被截取 
如果存入的长度比预设的短 那么占用的空间不变 varchar则是使用多少就是多少 由于长度固定所以在效率上
char比varchar高
.一张表的字段数不要太多,字段注释一定要注明,字段命名做到见名知意,可以预留扩展字段以作备用
### 2.2 范式
.第一范式 原子性(关系型数据库有列的概念,默认就符合)
.第二范式 消除对主键的部分依赖(使用一个与业务无关的字段作为主键,如innodb引擎的自增列)
.第三范式 消除对主键的传递依赖 高内聚 如商品表 可以分成主要信息和详细信息两张表
## 3 存储引擎的选择(innodb,myISAM)
* 功能差异 innodb支持事务处理 行级锁 外键
* 存储差异 
  1.存储方式 innodb数据和索引都在一起,myISAM的数据 索引都是分开存储的
  2.碎片 myISAM 删除数据是会产生随便,需要定期手动清理 命令为:optimize table tablename.但是innodb不会产生
* 选择依据 : 读多写少使用myISAM 如(新闻,博客网站); 读多写也多使用innodb (支持事务和外键,保证数据的一致性,完整性;并发能力强(行锁))
## 4 索引
### 4.1 什么是索引
从数据中提取具有标识性的关键字,并且有对应数据的关系
### 4.2 索引类型
* 主键索引(primary key) 要求关键字唯一且不能为null
* 普通索引(normal key) 符合索引仅按照第一字段有序
* 唯一索引(unique key) 要求关键字唯一
* 全文索引(fulltext key) 该索引不支持中文
### 4.3 索引的管理语法
* 查看索引  show create table xxx; desc xxx
* 建立索引 1 创建表时指定; 2.alter table xxx add key/ unique key/fulltext key key_name 
* 删除索引 alter table xxx  drop key xxx (如果删除的是主键,并且主键自增 需要先取消自增 再删除)
### 4.4 执行计划 explain
分析 sql 是否用到了索引 用到了哪些索引
### 4.5 索引的使用场景
* where: 如果查找的字段都建立了索引 则会索引覆盖
* order by: 如果排序字段建立了索引,而且索引又是有序排列的,则会直接根据索引拿出数据即可,与读取所有的结果出来再排序相比效率高得多
* join: 如果join 的字段建立了索引,那么会变得高效
* 什么是索引覆盖:直接对索引进行查找,而不用去读取数据
### 4.6 即使建立了索引但是也唯一会用到的情况
* where i+1= ? 若是对字段进行函数操作 则不会使用到索引 正确写发应为 where i= 1+?
* like  like '%keyword%' 不会使用索引, like "keyword%" 会使用到索引
* or 只有两边都建立了索引才会使用 否则不会用到
* !=或者<>,可能导致不走索引
### 4.7 索引的存储结构
* btree:搜索多叉树,节点内关键字有序排列,关键字之间有个指针
* b+tree:由btree升级而来,数据和关键字存储在一起,省去了关键之到数据的映射找数据的时间
## 5 缓存

 

